<!--pages/add-asset/add-asset.wxml-->
<view class="container">
  <form class="asset-form">
    <!-- èµ„äº§åç§° -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">èµ„äº§åç§°</text>
        <text class="required">*</text>
      </view>
      <input 
        class="form-input {{errors.name ? 'error' : ''}}"
        placeholder="è¯·è¾“å…¥èµ„äº§åç§°"
        value="{{formData.name}}"
        data-field="name"
        bindinput="onInputChange"
        bindblur="onInputChange"
        maxlength="50"
        focus="{{false}}"
        confirm-type="next"
      />
      <text class="error-text" wx:if="{{errors.name}}">{{errors.name}}</text>
    </view>

    <!-- èµ„äº§åˆ†ç±» -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">èµ„äº§åˆ†ç±»</text>
        <text class="required">*</text>
      </view>
      <view class="category-selector {{errors.category ? 'error' : ''}}" bindtap="showCategoryPicker">
        <view class="category-display">
          <view wx:if="{{formData.category}}" class="category-icon" style="background-color: {{categories[categoryIndex].color}}">
          </view>
          <text>{{formData.category || 'è¯·é€‰æ‹©åˆ†ç±»'}}</text>
        </view>
        <text class="selector-arrow"></text>
      </view>
      <text class="error-text" wx:if="{{errors.category}}">{{errors.category}}</text>
    </view>

    <!-- æŒæœ‰é‡‘é¢ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">æŒæœ‰é‡‘é¢</text>
        <text class="required">*</text>
      </view>
      <input 
        class="form-input number {{errors.amount ? 'error' : ''}}"
        type="digit"
        placeholder="è¯·è¾“å…¥æŒæœ‰é‡‘é¢"
        value="{{formData.amount}}"
        data-field="amount"
        bindinput="onNumberInput"
      />
      <text class="error-text" wx:if="{{errors.amount}}">{{errors.amount}}</text>
    </view>

    <!-- æŒæœ‰æ—¥æœŸ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">æŒæœ‰æ—¥æœŸ</text>
        <text class="required">*</text>
      </view>
      <picker 
        mode="date" 
        value="{{formData.purchaseDate}}" 
        end="{{maxDate}}"
        bindchange="onDateChange"
        class="date-picker"
      >
        <view class="date-display {{errors.purchaseDate ? 'error' : ''}}">
          <text class="date-text">{{formData.purchaseDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</text>
          <text class="selector-arrow"></text>
        </view>
      </picker>
      <text class="error-text" wx:if="{{errors.purchaseDate}}">{{errors.purchaseDate}}</text>
    </view>

    <!-- é¢„è®¡ä¼°å€¼ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">é¢„è®¡ä¼°å€¼</text>
        <text class="optional">ï¼ˆé€‰å¡«ï¼‰</text>
      </view>
      <view class="value-input-container">
        <input 
          class="form-input number {{errors.currentValue ? 'error' : ''}}"
          type="digit"
          placeholder="ä¸å¡«åˆ™æ˜¾ç¤ºåŸä»·"
          value="{{formData.currentValue}}"
          data-field="currentValue"
          bindinput="onNumberInput"
        />
        <button class="ai-estimate-btn" wx:if="{{hasApiKey}}" bindtap="performAIEstimate" disabled="{{isEstimating}}">
          <text class="ai-icon">ğŸ¤–</text>
          <text>{{isEstimating ? 'AIä¼°å€¼ä¸­...' : 'AIä¼°å€¼'}}</text>
        </button>
      </view>
      <text class="error-text" wx:if="{{errors.currentValue}}">{{errors.currentValue}}</text>
      <text class="form-hint" wx:if="{{aiEstimateResult}}">AIä¼°å€¼å»ºè®®ï¼š{{aiEstimateResult}}</text>
    </view>

    <!-- å¤‡æ³¨ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">å¤‡æ³¨</text>
        <text class="optional">ï¼ˆå¯é€‰ï¼‰</text>
      </view>
      <textarea 
        class="form-textarea"
        placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯..."
        value="{{formData.remark}}"
        data-field="remark"
        bindinput="onInputChange"
        bindblur="onInputChange"
        maxlength="200"
        auto-height
        focus="{{false}}"
        confirm-type="done"
      />
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button class="btn btn-secondary" bindtap="resetForm" wx:if="{{!isEdit}}">
        é‡ç½®
      </button>
      <button class="btn btn-primary" bindtap="saveAsset">
        {{isEdit ? 'æ›´æ–°èµ„äº§' : 'æ·»åŠ èµ„äº§'}}
      </button>
    </view>
  </form>

  <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
  <picker-view 
    class="category-picker {{showCategoryPicker ? 'show' : ''}}"
    value="{{[categoryIndex]}}"
    bindchange="onCategoryChange"
    wx:if="{{showCategoryPicker}}"
  >
    <picker-view-column>
      <view class="picker-item" wx:for="{{categories}}" wx:key="key">
        <view class="category-option">
          <view class="category-color" style="background-color: {{item.color}}"></view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </picker-view-column>
  </picker-view>

  <!-- é®ç½©å±‚ -->
  <view class="picker-mask {{showCategoryPicker ? 'show' : ''}}" bindtap="onCategoryCancel" wx:if="{{showCategoryPicker}}"></view>
</view>