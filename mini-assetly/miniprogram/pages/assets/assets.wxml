<!--pages/assets/assets.wxml-->
<view class="container">
  <!-- åˆ†äº«æŒ‰é’® -->
  <view class="share-header">
    <button class="share-btn" bindtap="shareImage">
      <text class="share-icon">ğŸ“¤</text>
      <text>ç”Ÿæˆåˆ†äº«å›¾ç‰‡</text>
    </button>
  </view>

  <!-- èµ„äº§æŠ¥å‘Šé¢„è§ˆ -->
  <view class="share-preview">
    <!-- æ ‡é¢˜ -->
    <view class="preview-header">
      <text class="preview-title">æˆ‘çš„èµ„äº§æŠ¥å‘Š</text>
      <text class="preview-date">{{currentDate}}</text>
    </view>

    <!-- æ€»èµ„äº§ -->
    <view class="total-asset">
      <text class="total-label">æ€»èµ„äº§</text>
      <text class="total-amount number">{{formattedTotalAmount}}</text>
      <text class="total-count">å…± <text class="number">{{assets.length}}</text> é¡¹èµ„äº§</text>
    </view>

    <!-- èµ„äº§åˆ†å¸ƒ -->
    <view class="asset-distribution" wx:if="{{categoryData.length > 0}}">
      <text class="section-title">èµ„äº§åˆ†å¸ƒ</text>
      <view class="category-list">
        <view class="category-item" wx:for="{{categoryData}}" wx:key="category">
          <view class="category-info">
            <image class="category-icon" src="{{item.icon}}" mode="aspectFit"></image>
            <text class="category-name">{{item.category}}</text>
            <text class="category-percentage number">{{item.percentage}}%</text>
          </view>
          <text class="category-amount number">{{item.formattedAmount}}</text>
        </view>
      </view>
    </view>

    <!-- èµ„äº§åˆ—è¡¨ -->
    <view class="asset-list" wx:if="{{allAssets.length > 0}}">
      <text class="section-title">èµ„äº§åˆ—è¡¨</text>
      <view class="asset-items">
        <view class="asset-item" wx:for="{{allAssets}}" wx:key="id" wx:for-index="index">
          <view class="asset-main">
            <view class="asset-header">
              <image class="asset-category-icon" src="{{item.categoryIcon}}" mode="aspectFit"></image>
              <text class="asset-name">{{item.name}}</text>
            </view>
            <view class="asset-meta">
              <text class="asset-category">{{item.category}}</text>
              <view class="asset-holding-tag" wx:if="{{item.holdingTime}}">{{item.holdingTime}}</view>
            </view>
            <text class="asset-remark" wx:if="{{item.remark}}">{{item.remark}}</text>
          </view>
          <view class="asset-value">
            <text class="current-value number">{{item.formattedDisplayValue}}</text>
            <text class="original-value number" wx:if="{{item.currentValue !== undefined && item.currentValue !== item.amount}}">
              åŸä»·: {{item.formattedAmount}}
            </text>
            <text class="purchase-date">{{item.formattedPurchaseDate}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{assets.length === 0}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— èµ„äº§è®°å½•</text>
      <text class="empty-hint">æ·»åŠ èµ„äº§åå¯ç”Ÿæˆåˆ†äº«æŠ¥å‘Š</text>
    </view>

    <!-- é¡µè„š -->
    <view class="preview-footer">
      <text class="footer-text">ç”± ç‰©å•éšè®° ç”Ÿæˆ</text>
    </view>
  </view>

  <!-- éšè—çš„ç”»å¸ƒç”¨äºç”Ÿæˆå›¾ç‰‡ -->
  <canvas type="2d" id="shareCanvas" class="share-canvas"></canvas>

  <!-- åˆ†äº«é¢„è§ˆå¼¹æ¡† -->
  <view class="share-modal" wx:if="{{showShareModal}}" bindtap="closeShareModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">åˆ†äº«é¢„è§ˆ</text>
        <text class="modal-close" bindtap="closeShareModal">Ã—</text>
      </view>
      <scroll-view class="modal-body" scroll-y="true">
        <image class="preview-image" src="{{shareImagePath}}" mode="widthFix"></image>
      </scroll-view>
      <view class="modal-footer">
        <button class="modal-btn primary" bindtap="downloadImage">ä¿å­˜åˆ°ç›¸å†Œ</button>
        <button class="modal-btn primary" bindtap="shareImage">ç›´æ¥åˆ†äº«</button>
      </view>
    </view>
  </view>
</view>