<!--pages/chart/chart.wxml-->
<view class="container">
  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="chart-tabs">
    <view class="tab-item {{tabType === 'distribution' ? 'active' : ''}}" 
          data-type="distribution" bindtap="switchTab">
      <text class="tab-text">èµ„äº§åˆ†å¸ƒ</text>
    </view>
    <view class="tab-item {{tabType === 'analysis' ? 'active' : ''}}" 
          data-type="analysis" bindtap="switchTab">
      <text class="tab-text">ä¸ªäººæ€»ç»“</text>
    </view>
  </view>

  <!-- èµ„äº§åˆ†å¸ƒé¡µé¢ -->
  <view class="distribution-container" wx:if="{{tabType === 'distribution'}}">
    
    <!-- çŸ©å½¢æ ‘å›¾åˆ†æ -->
    <view class="module-card">
      <view class="module-header">
        <text class="module-title">ğŸ“Š çŸ©å½¢æ ‘å›¾åˆ†æ</text>
        <text class="total-amount number">æ€»è®¡ï¼š{{formattedTotalAmount}}</text>
      </view>
      
      <view class="pie-section" wx:if="{{categoryData.length > 0}}">
        <!-- çŸ©å½¢æ ‘å›¾æ˜¾ç¤º -->
        <view class="pie-chart">
          <!-- EChartsçŸ©å½¢æ ‘å›¾ -->
          <ec-canvas id="mychart-dom-pie" canvas-id="mychart-pie" ec="{{ pieEc }}"></ec-canvas>
        </view>

        <!-- åˆ†ç±»åˆ—è¡¨ -->
        <view class="category-list">
          <view class="category-item" wx:for="{{categoryData}}" wx:key="key">
            <view class="category-info">
              <view class="category-dot" style="background-color: {{item.color}}"></view>
              <image class="category-icon" src="{{item.icon}}" mode="aspectFit"></image>
              <text class="category-name">{{item.name}}</text>
            </view>
            <view class="category-stats">
              <text class="category-amount number">{{item.formattedValue}}</text>
              <text class="category-percentage">{{item.percentage}}%</text>
            </view>
          </view>
        </view>
      </view>

      <view class="empty-state" wx:if="{{categoryData.length === 0}}">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>
    </view>

    <!-- ç±»åˆ«å¯¹æ¯” -->
    <view class="module-card">
      <view class="module-header">
        <text class="module-title">ğŸ“ˆ ç±»åˆ«å¯¹æ¯”</text>
      </view>
      
      <view class="comparison-section" wx:if="{{categoryComparison.length > 0}}">
        <view class="comparison-item" wx:for="{{categoryComparison}}" wx:key="key">
          <view class="comparison-info">
            <image class="comparison-icon" src="{{item.icon}}" mode="aspectFit"></image>
            <text class="comparison-name">{{item.name}}</text>
          </view>
          <view class="comparison-bar">
            <view class="bar-fill" 
                  style="width: {{item.barWidth}}%; background-color: {{item.color}};">
            </view>
          </view>
          <text class="comparison-value number">{{item.formattedValue}}</text>
        </view>
      </view>

      <view class="empty-state" wx:if="{{categoryComparison.length === 0}}">
        <text class="empty-icon">ğŸ“ˆ</text>
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>
    </view>

    <!-- è¶‹åŠ¿åˆ†æ -->
    <view class="module-card">
      <view class="module-header">
        <text class="module-title">ğŸ“Š è¶‹åŠ¿åˆ†æ</text>
      </view>
      
      <view class="trend-section" wx:if="{{trendData.length > 0}}">
        <!-- è¶‹åŠ¿å›¾ -->
        <view class="trend-graph">
          <!-- EChartsæŠ˜çº¿å›¾ -->
          <ec-canvas id="mychart-dom-trend" canvas-id="mychart-trend" ec="{{ trendEc }}"></ec-canvas>
        </view>
      </view>

      <view class="empty-state" wx:if="{{trendData.length === 0}}">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>
    </view>

    <!-- åˆ†ç±»æ±‡æ€» -->
    <view class="module-card">
      <view class="module-header">
        <text class="module-title">ğŸ“‹ åˆ†ç±»æ±‡æ€»</text>
      </view>
      
      <view class="summary-section">
        <view class="summary-grid">
          <view class="summary-item">
            <text class="summary-label">èµ„äº§æ€»æ•°</text>
            <text class="summary-value number">{{categorySummary.totalAssets}}</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">èµ„äº§æ€»å€¼</text>
            <text class="summary-value number">{{categorySummary.formattedTotalValue}}</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">åˆ†ç±»æ•°é‡</text>
            <text class="summary-value number">{{categorySummary.categoryCount}}</text>
          </view>
          <view class="summary-item">
            <text class="summary-label">å¹³å‡ä»·å€¼</text>
            <text class="summary-value number">{{categorySummary.formattedAverageValue}}</text>
          </view>
        </view>

        <view class="top-category" wx:if="{{categorySummary.topCategory}}">
          <text class="top-label">æœ€å¤§èµ„äº§ç±»åˆ«</text>
          <view class="top-info">
            <image class="top-icon" src="{{categorySummary.topCategory.icon}}" mode="aspectFit"></image>
            <text class="top-name">{{categorySummary.topCategory.name}}</text>
            <text class="top-value number">{{categorySummary.topCategory.formattedValue}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸ªäººæ€»ç»“é¡µé¢ -->
  <view class="analysis-container" wx:if="{{tabType === 'analysis'}}">
    
    <!-- ä¸ªäººè´¢åŠ¡å®åŠ›åˆ†æ -->
    <view class="module-card">
      <view class="module-header">
        <text class="module-title">ğŸ¯ ä¸ªäººèµ„äº§åˆ†æ</text>
        <view class="analysis-actions" wx:if="{{!isAnalyzing}}">
          <button class="refresh-btn" bindtap="generateAIAnalysis" size="mini">
            <text>é‡æ–°åˆ†æ</text>
          </button>
        </view>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{isAnalyzing}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">AIæ­£åœ¨åˆ†ææ‚¨çš„è´¢åŠ¡çŠ¶å†µ...</text>
      </view>
      
      <!-- æ€»ä½“åˆ†æå¡ç‰‡ -->
      <view class="overall-analysis-card" wx:else>
        <view class="rank-display">
          <view class="rank-info">
            <text class="rank-label">è´¢åŠ¡å®åŠ›æ®µä½</text>
            <text class="rank-badge {{rankingClass}}">{{rankingLevel}}</text>
          </view>
          
          <view class="score-stats">
            <view class="score-item">
              <text class="score-label">ç»¼åˆè¯„åˆ†</text>
              <text class="score-value number">{{rankingScore}}</text>
              <text class="score-total">æ€»åˆ† <text class="number">{{totalScore}}</text>/600</text>
            </view>
            
            <view class="ranking-info">
              <text class="ranking-label">æ’åæƒ…å†µ</text>
              <view class="ranking-stats">
                <view class="ranking-item">
                  <text class="ranking-desc">åœ°åŒºæ’å:</text>
                  <text class="ranking-percent regional">å‰{{regionalRanking}}%</text>
                </view>
                <view class="ranking-item">
                  <text class="ranking-desc">å…¨å›½æ’å:</text>
                  <text class="ranking-percent national">å‰{{nationalRanking}}%</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- åˆ†ææ‘˜è¦ -->
          <view class="analysis-summary">
            <text class="summary-text">{{rankingAnalysisSummary}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- é›·è¾¾å›¾ -->
    <view class="module-card" wx:if="{{!isAnalyzing && radarData.length > 0}}">
      <view class="module-header">
        <text class="module-title">ğŸ“Š èƒ½åŠ›é›·è¾¾å›¾</text>
      </view>
      
      <view class="radar-section">
        <!-- EChartsé›·è¾¾å›¾ -->
        <view class="radar-chart">
          <ec-canvas id="mychart-dom-radar" canvas-id="mychart-radar" ec="{{ radarEc }}"></ec-canvas>
        </view>
        
        <!-- é›·è¾¾æ•°æ®åˆ—è¡¨ -->
        <view class="radar-list">
          <view class="radar-item" wx:for="{{radarData}}" wx:key="dimension">
            <view class="radar-info">
              <text class="radar-dimension">{{item.dimension}}</text>
              <text class="radar-score-text number">{{item.score}}åˆ†</text>
            </view>
            <view class="radar-bar">
              <view class="radar-fill" 
                    style="width: {{item.score}}%; background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%)">
                <text class="radar-bar-score number">{{item.formattedScore}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- èººå¹³ç”Ÿæ´»åˆ†æ -->
    <view class="module-card analysis-note" wx:if="{{!isAnalyzing}}">
      <view class="module-header">
        <text class="module-title">ğŸ›‹ï¸ èººå¹³ç”Ÿæ´»åˆ†æ</text>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{isAnalyzing}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">æ­£åœ¨åˆ†ææ‚¨çš„èººå¹³ç”Ÿæ´»æ–¹æ¡ˆ...</text>
      </view>
      
      <!-- èººå¹³åˆ†æç»“æœ -->
      <view class="life-analysis-content" wx:else>
        <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
        <view class="life-summary-card">
          <view class="life-stats">
            <view class="life-stat-item">
              <text class="life-stat-label">å¯èººå¹³æ—¶é•¿</text>
              <text class="life-stat-value">{{lifeDuration}}</text>
            </view>
            <view class="life-stat-item">
              <text class="life-stat-label">å»ºè®®æ—¥é¢„ç®—</text>
              <text class="life-stat-value">Â¥{{dailyBudget}}</text>
            </view>
          </view>
        </view>

        <!-- æ¨èåŸå¸‚ -->
        <view class="recommended-cities" wx:if="{{recommendedCities.length > 0}}">
          <text class="section-title">ğŸ™ï¸ æ¨èèººå¹³åŸå¸‚</text>
          <view class="cities-list">
            <view class="city-item" wx:for="{{recommendedCities}}" wx:key="name">
              <view class="city-info">
                <text class="city-name">{{item.name}}</text>
                <text class="city-cost">æœˆå¼€é”€: Â¥{{item.monthlyCost}}</text>
              </view>
              <text class="city-duration">{{item.duration}}</text>
            </view>
          </view>
        </view>

        <!-- ç”Ÿæ´»æ–¹æ¡ˆå¯¹æ¯” -->
        <view class="life-plans" wx:if="{{lifePlans.length > 0}}">
          <text class="section-title">ğŸ“‹ ç”Ÿæ´»æ–¹æ¡ˆå¯¹æ¯”</text>
          <view class="plans-list">
            <view class="plan-item" wx:for="{{lifePlans}}" wx:key="type">
              <view class="plan-header">
                <text class="plan-type">{{item.type}}</text>
                <text class="plan-duration">{{item.duration}}</text>
              </view>
              <view class="plan-details">
                <text class="plan-budget">æ—¥é¢„ç®—: Â¥{{item.dailyBudget}}</text>
                <text class="plan-description">{{item.description}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="note-content">
        <text class="note-item">* èººå¹³åˆ†æåŸºäºå½“å‰èµ„äº§çŠ¶å†µå’Œå¹³å‡ç”Ÿæ´»æˆæœ¬è®¡ç®—ã€‚</text>
        <text class="note-item" wx:if="{{analysisType === 'ai'}}">* AIåˆ†æè€ƒè™‘äº†æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œåœ°åŒºå·®å¼‚ï¼Œæä¾›æ›´ç²¾å‡†çš„å»ºè®®ã€‚</text>
        <text class="note-item" wx:else>* æœ¬åœ°åˆ†æåŸºäºé€šç”¨æ•°æ®ï¼Œå¦‚éœ€ä¸ªæ€§åŒ–åˆ†æè¯·åœ¨è®¾ç½®ä¸­é…ç½®AIå¯†é’¥ã€‚</text>
        <text class="note-item">* å®é™…ç”Ÿæ´»æˆæœ¬å› ä¸ªäººä¹ æƒ¯å’Œæ¶ˆè´¹æ°´å¹³è€Œå¼‚ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚</text>
      </view>
    </view>
  </view>
</view>