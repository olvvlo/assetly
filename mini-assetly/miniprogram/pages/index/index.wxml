<!--pages/index/index.wxml-->
<view class="container">
  <!-- 头部 -->
  <view class="header">
    <view class="header-left">
      <image class="app-icon" src="/images/app-icon.png" mode="aspectFit"></image>
      <view class="title-group">
        <text class="main-title">口袋轻账</text>
        <text class="sub-title">个人资产管理</text>
      </view>
    </view>
    <view class="header-right">
        <view class="add-btn" bindtap="goToAdd">
          <image class="add-icon" src="/images/icons/add-line.png" mode="aspectFit"></image>
        </view>
      </view>
  </view>

  <!-- 总资产卡片 -->
  <view class="total-card">
    <view class="total-left">
      <text class="total-label">总资产</text>
      <text class="total-amount number">{{formattedTotalAmount}}</text>
    </view>
    <view class="total-right">
      <text class="asset-count-text number">{{assetCount}}</text>
      <text class="asset-count-label">项资产</text>
    </view>
  </view>

  <!-- 资产列表 -->
  <view class="asset-section" wx:if="{{assetCount > 0}}">
    <view class="section-header">
      <text class="section-title">资产列表</text>
      <view class="sort-options">
        <text class="sort-btn {{sortBy === 'time' ? 'active' : ''}}" bindtap="sortByTime">时间</text>
        <text class="sort-btn {{sortBy === 'amount' ? 'active' : ''}}" bindtap="sortByAmount">金额</text>
      </view>
    </view>
    <view class="category-groups">
      <view class="category-group" wx:for="{{groupedAssets}}" wx:key="category">
        <view class="category-header" bindtap="toggleCategory" data-category="{{item.category}}">
          <image class="category-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <text class="category-name">{{item.category}}</text>
          <text class="category-total number">{{item.formattedTotal}}</text>
          <view class="collapse-icon {{item.collapsed ? 'collapsed' : ''}}">
            <text>▼</text>
          </view>
        </view>
        <view class="asset-list" wx:if="{{!item.collapsed}}">
          <view class="asset-item" wx:for="{{item.assets}}" wx:key="id" wx:for-item="asset" bindtap="editAsset" data-asset="{{asset}}">
            <view class="asset-left">
              <view class="asset-info">
                <text class="asset-name">{{asset.name}}</text>
                <view class="asset-meta">
                  <text class="asset-date">2025年 3 月 19日{{formatDate(asset.createTime || asset.createdAt)}}</text>
                  <view class="asset-holding-tag" wx:if="{{asset.holdingTime}}">{{asset.holdingTime}}</view>
                </view>
              </view>
              <text class="asset-remark" wx:if="{{asset.remark}}">{{asset.remark}}</text>
            </view>
            <view class="asset-right">
            <text class="asset-amount number">{{asset.formattedDisplayValue}}</text>
            <text class="asset-original number" wx:if="{{asset.currentValue !== undefined && asset.currentValue !== asset.amount}}">
              原价: {{asset.formattedAmount}}
            </text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{assetCount === 0}}">
    <view class="empty-icon"><image class="empty-image" src="/images/icons/empty.png" /></view>
    <text class="empty-title">还没有资产记录</text>
    <text class="empty-desc">点击上方按钮开始添加您的第一项资产</text>
    <button class="empty-btn" bindtap="goToAdd">立即添加</button>
  </view>
</view>